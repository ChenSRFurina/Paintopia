# 截图功能说明

## 功能概述

Paintopia 的截图功能可以截取画布内容并发送给 AI 进行分析，获得绘画建议。

## 功能特点

### 1. 精确截图
- 只截取画布区域，不包括工具栏和右侧建议区
- 保持画布的高清质量（800x600 分辨率）
- 包含所有已完成的绘画路径

### 2. 实时预览
- 截图后立即在画布上方显示缩略图
- 缩略图可点击关闭
- 3秒后自动隐藏

### 3. AI 分析
- 截图自动发送给 Qwen2.5-VL 模型
- 获得约30字的绘画建议
- 支持中文分析

## 使用方法

### 1. 配置 API Key
```bash
# 方式一：使用设置脚本
./setup_api.sh

# 方式二：手动创建 .env 文件
cp env.template .env
# 编辑 .env 文件，填入你的 OpenRouter API key
```

### 2. 进行绘画
- 在画布上自由绘画
- 使用不同颜色和笔刷大小
- 使用橡皮擦修改

### 3. 截图分析
- 点击右侧"截图分析"按钮
- 等待 AI 分析（通常需要几秒钟）
- 查看 AI 提供的绘画建议

## 技术实现

### 截图流程
1. 用户点击"截图分析"按钮
2. 系统创建画布内容的渲染视图
3. 使用 ImageRenderer 生成 UIImage
4. 显示缩略图预览
5. 将图片发送给 AI 分析

### 文件结构
```
paintopia/
├── Views/
│   ├── MainView.swift          # 主视图，包含截图逻辑
│   ├── CanvasView.swift        # 画布视图
│   └── SuggestionView.swift    # 建议视图，包含截图按钮
├── Services/
│   └── OpenRouterService.swift # AI 服务
└── Utils/
    └── ScreenshotTest.swift    # 截图测试工具
```

## 故障排除

### 常见问题

1. **截图失败**
   - 检查画布是否有内容
   - 确认应用有足够内存

2. **AI 分析失败**
   - 检查 API Key 是否正确配置
   - 确认网络连接正常
   - 查看控制台错误信息

3. **缩略图不显示**
   - 检查截图是否成功生成
   - 确认 UI 更新在主线程执行

### 调试信息

应用会在控制台输出以下信息：
- `✅ 加载环境变量: OPENROUTER_API_KEY` - API Key 加载成功
- `⚠️ 未找到 .env 文件` - 配置文件缺失
- `❌ 截图失败` - 截图生成失败
- `AI 正在分析中...` - AI 分析进行中

## 扩展功能

### 未来计划
- 支持保存截图到相册
- 添加截图历史记录
- 支持多种 AI 模型选择
- 添加截图编辑功能

### 自定义配置
- 修改截图分辨率
- 调整缩略图显示时间
- 自定义 AI 分析提示词 